---
layout: default.ja
title: Session Management
navOrder: 7
navTitle: Session
permalink: /sp800-63b/session/
anchor: sec7
section: 7
---

# Session Management {#sec7}

_This section is normative._

<!--
Once an authentication event has taken place, it is often desirable to allow the subscriber to continue using the application across multiple subsequent interactions without requiring them to repeat the authentication event. This requirement is particularly true for federation scenarios — described in [[SP800-63C]](../_sp800-63c/sec1_purpose.md#purpose){:latex-href="#ref-SP800-63C"} — where the authentication event necessarily involves several components and parties coordinating across a network.
-->

一度 Authentication イベントが発生すると, Subscriber が Authentication イベントを繰り返さなくとも, 後続の複数のインタラクションに渡ってアプリケーションを使い続けられるようにすることが望ましいことが多い.
この要件は [[SP800-63C]](../_sp800-63c/sec1_purpose.md#purpose){:latex-href="#ref-SP800-63C"} で述べる Federation シナリオで特に当てはまる.
Federation シナリオでは, Authentication イベントに複数のコンポーネントおよび当事者が関与し, Network 全体で協調する必要がある.

<!--
To facilitate this behavior, a *session* **MAY** be started in response to an authentication event, and continue the session until such time that it is terminated. The session **MAY** be terminated for any number of reasons, including but not limited to an inactivity timeout, an explicit logout event, or other means. The session **MAY** be continued through a reauthentication event — described in [Sec. 7.2](sec7_session.md#sessionreauthn) — wherein the subscriber repeats some or all of the initial authentication event, thereby re-establishing the session.
-->

上記の挙動を円滑にするため, Authentication イベントに呼応して *Session* を開始して, 終了されるまでそれを継続させることもできる (*MAY*).
Session は, 非アクティブタイムアウト, 明示的ログアウトイベント, またはその他の手段を含む, 様々な理由で終了させてよい (*MAY*).
Session は [Sec. 7.2](sec7_session.md#sessionreauthn) で述べる Reauthentication イベントを通じて継続してもよい (*MAY*).
Reauthentication イベントでは, Subscriber は最初の Authentication イベントの一部または全てを繰り返し, それにより Session を再確立する.

<!--
Session management is preferable over continual presentation of credentials as the poor usability of continual presentation often creates incentives for workarounds such as caching of activation factors, negating authentication intent and obscuring the freshness of the authentication event.
-->

Session Management は頻発する Credential の提示より好ましい.
Credential の提示が頻発すると Usability が悪化し, Activation Factor のキャッシング, Authentication Intent の無効化, Authentication イベントの鮮度の不明瞭化などを引き起こすような回避策へのインセンティブを引き起こすことが多い.

## Session Bindings

<!--
A session occurs between the software that a subscriber is running &mdash; such as a browser, application, or operating system (i.e., the session subject) &mdash; and the RP or CSP that the subscriber is accessing (i.e., the session host). A session secret **SHALL** be shared between the subscriber's software and the service being accessed. This secret binds the two ends of the session, allowing the subscriber to continue using the service over time. The secret **SHALL** be presented directly by the subscriber's software or possession of the secret **SHALL** be proven using a cryptographic mechanism.
-->

Session は, Subscriber が実行しているソフトウェア - ブラウザ, アプリケーションないしオペレーティングシステム (i.e., Session Subject) - と, Subscriber が Access している RP ないし CSP (i.e., Session Host) の間で発生する.
Session Secret は Subscriber のソフトウェアと Access されるサービスの間で共有しなければならない (**SHALL**).
このシークレットは Session の両端を Bind し, Subscriber が長時間サービスを使い続けられるようにする.
このシークレットは Subscriber ソフトウェアから直接提示されるか (**SHALL**), 暗号論的メカニズムによりその保有が証明されなければならない (**SHALL**).

<!--
Continuity of authenticated sessions **SHALL** be based upon the possession of a session secret issued by the verifier at the time of authentication and optionally refreshed during the session. The nature of a session depends on the application, such as:
-->

Authenticated Session の継続性は, Authentication 時に Verifier に発行され, オプションで Session 中に更新される Session Secret を保持しているかどうかに基づいている必要がある (**SHALL**).
Session の性質は次のようなアプリケーションによって異なる.

<!--
* a web browser session with a "session" cookie, or
* an instance of a mobile application that retains a session secret.
-->

* "Session" Cookie による Web ブラウザ Session
* Session Secret を保持するモバイルアプリケーション

<!--
Session secrets **SHALL NOT** be persistent (retained across a restart of the associated application or a reboot of the host device).
-->

Session Secret は永続的 (紐づくアプリケーションのリスタートやホストデバイスのリブートを挟んでも保持される) であってはならない (**SHALL NOT**).

<!--
The secret used for session binding **SHALL** be generated by the session host in direct response to an authentication event. A session **SHOULD** inherit the AAL properties of the authentication event which triggered its creation. A session **MAY** be considered at a lower AAL than the authentication event but **SHALL NOT** be considered at a higher AAL than the authentication event.
-->

Session Binding に用いられるシークレットは, Authentication イベントに直接レスポンスする Session Host によって生成されなければならない (**SHALL**).
Session は, それを生成するトリガーとなった Authentication イベントの AAL プロパティを継承すべきである (**SHOULD**).
Session は Authentication イベントより低い AAL であるとみなすこともできるが (**MAY**), Authentication イベントより高い AAL であるとみなしてはならない (**SHALL NOT**).

<!--
Secrets used for session binding **SHALL** meet all of the following requirements:
-->

Session Binding に用いられるシークレットは以下の全要件を満たさねばならない (**SHALL**).

<!--
1. Secrets are generated by the session host during an interaction, typically immediately following authentication.
2. Secrets are generated by an approved random bit generator [[SP800-90Ar1]](references.md#ref-SP800-90Ar1) and contain at least 64 bits of entropy.
3. Secrets are erased or invalidated by the session subject when the subscriber logs out.
4. Secrets are sent to and received from the device using an authenticated protected channel.
5. Secrets will time out and are not accepted after the times specified in [Sections 4.1.3](sec4_aal.md#aal1reauth), [4.2.3](sec4_aal.md#aal2reauth), and [4.3.3](sec4_aal.md#aal3reauth), as appropriate for the AAL.
6. Secrets are not made available to insecure communications between the host and subscriber's endpoint.
-->

1. シークレットは Session Host によってインタラクション中に生成されること. 通常は Authentication 直後に.
2. シークレットは Approved なランダムビット生成器 [[SP800-90Ar1]](references.md#ref-SP800-90Ar1) で生成し, 少なくとも64bitの Entropy を持つこと.
3. シークレットは Subscriber がログアウトした際は Session Subject により消去ないし無効化されること.
4. シークレットは Authenticated Protected Channel を利用したデバイスによって送信, 受信されること.
5. シークレットは, AAL に応じて, [Sections 4.1.3](sec4_aal.md#aal1reauth), [4.2.3](sec4_aal.md#aal2reauth), ないし [4.3.3](sec4_aal.md#aal3reauth) に指定された時間を超えたのちはタイムアウトし, 受け入れられないこと.
6. シークレットは Host と Subscriber エンドポイント間のセキュアでないコミュニケーションにさらさないこと.

<!--
In addition, secrets used for session binding **SHOULD** be erased on the subscriber endpoint when they log out or when the secret is deemed to have expired. They **SHOULD NOT** be placed in insecure locations such as HTML5 Local Storage due to the potential exposure of local storage to cross-site scripting (XSS) attacks.
-->

さらに, Session Binding に用いられるシークレットは, Subscriber がログアウトしたりシークレット自身が有効期限切れになったと見なされた時に, Subscriber エンドポイントから削除されるべきである (**SHOULD**).
シークレットは HTML5 Local Storage などのセキュアでない場所に置くべきではない (**SHOULD NOT**).
ローカルストレージは Cross-site Scripting (XSS) Attack に晒される可能性がある.

<!--
Authenticated sessions **SHALL NOT** fall back to an insecure transport, such as from https to http, following authentication.
-->

Authenticated Session は Authentication 後に, HTTPS から HTTP など, セキュアでない通信路にフォールバックしてはならない (**SHALL NOT**).

<!--
URLs or POST content **SHALL** contain a session identifier that **SHALL** be verified by the RP to protect against cross-site request forgery.
-->

URL や POST コンテンツには, Cross-site Request Forgery 対策のために, RP が検証する (**SHALL**) Session 識別子を含めることとする (**SHALL**).

<!--
There are several mechanisms for managing a session over time. The following sections give different examples along with additional requirements and considerations particular to each example technology. Additional informative guidance is available in the OWASP *Session Management Cheat Sheet* [[OWASP-session]](references.md#ref-OWASP-session).
-->

長時間 Session を管理するためのメカニズムはいくつか存在する.
後続のセクションでは, さまざまな例を, 各テクノロジー例固有の追加要件および考慮事項とともに示す.
OWASP *Session Management Cheat Sheet* [[OWASP-session]](references.md#ref-OWASP-session) にも追加の有益なガイダンスが存在する.

### Browser Cookies

<!--
Browser cookies are the predominant mechanism by which a session will be created and tracked for a subscriber accessing a service. Cookies are not authenticators, but they are suitable as short-term secrets (for the duration of a session).
-->

ブラウザ Cookie は, Session を生成するための有力なメカニズムであり, サービスに Access する Subscriber を追跡するものである.
Cookie は Authenticator ではないが, 短期間のシークレット (セッション中) に適している.

<!--
Cookies used for session maintenance **SHALL** meet all of the following requirements:
-->

Session の維持に用いられる Cookie は以下の全要件を満たすこと (**SHALL**).

<!--
1. Cookies are tagged to be accessible only on secure (HTTPS) sessions.
2. Cookies are accessible to the minimum practical set of hostnames and paths.
-->

1. Cookie はセキュア (HTTPS) Session でのみアクセス可能なようタグ付けすること.
2. Cookie は必要最小限のホスト名およびパスのセットでのみアクセス可能であること.

<!--
In addition, session maintenance cookies **SHOULD** be tagged to be inaccessible via JavaScript (HttpOnly). They **SHOULD** contain only an opaque string (such as a session identifier), and **SHOULD NOT** contain cleartext PII. They **SHOULD** be tagged to expire at, or soon after, the session's validity period. This latter requirement is intended to limit the accumulation of cookies, but **SHALL NOT** be depended upon to enforce session timeouts.
-->

さらに, Session 維持用 Cookie は, JavaScript からアクセスできないようにタグ付け (HttpOnly) されるべきである (**SHOULD**).
当該 Cookie は, Opaque 文字列 (Session 識別子など) のみで構成されるべきであり (**SHOULD**), 平文の PII を含むべきではない (**SHOULD NOT**).
また当該 Cookie は, Session 有効期間終了時または終了後すぐに有効期限切れになるようタグ付けされるべきである (**SHOULD**).
最後の要件は Cookie の蓄積を制限することを目的としたものであり, Session タイムアウトの強制のためにそれに依存してはならない (**SHALL NOT**).

### Access Tokens

<!--
An access token — such as found in OAuth — is used to allow an application to access a set of services on a subscriber's behalf following an authentication event. The presence of an OAuth access token **SHALL NOT** be interpreted by the RP as presence of the subscriber, in the absence of other signals. The OAuth access token, and any associated refresh tokens, **MAY** be valid long after the authentication session has ended and the subscriber has left the application.
-->

Access Token - OAuth などで見られる - は, アプリケーションが Authentication イベント後に Subscriber の代理としてあるサービス群に Access することを許可するために用いられる.
RP は, 他のシグナルがない限り, OAuth Access Token が存在することをもって Subscriber がそこに存在すると解釈してはならない (**SHALL NOT**).
OAuth Access Token および関連する Refresh Token は, Authentication Session が終了し Subscriber がアプリケーションを去った後でも長期間有効でありうる (**MAY**).

### Device Identification

<!--
Other methods of secure device identification &mdash; including but not limited to mutual TLS, token binding, or other mechanisms &mdash; **MAY** be used to enact a session between a subscriber and a service.
-->

Secure Device Identification のその他の手法 - mutual TLS, Token Binding, またはその他のメカニズム - も, Subscriber とサービスの間で Session を実現するために使用できる (**MAY**).

## Reauthentication {#sessionreauthn}

<!--
Periodic reauthentication of sessions **SHALL** be performed to confirm the continued presence of the subscriber at an authenticated session (i.e., that the subscriber has not walked away without logging out).
-->

Session の定期的な Reauthentication を実行し, Authenticated Session に Subscriber が引き続き存在することを確認すること (**SHALL**).
(i.e., Subscriber がログアウトせずに立ち去っていないか)

<!--
A session **SHALL NOT** be extended past the guidelines in Sections [4.1.3](sec4_aal.md#aal1reauth), [4.2.3](sec4_aal.md#aal2reauth), and [4.3.3](sec4_aal.md#aal3reauth) (depending on AAL) based on presentation of the session secret alone. Prior to session expiration, the reauthentication time limit **SHALL** be extended by prompting the subscriber for the authentication factors specified in [Table 2](sec7_session.md#table-2).
-->

Session は, Session Secret の提示のみをもって, (AAL に応じて) セクション [4.1.3](sec4_aal.md#aal1reauth), [4.2.3](sec4_aal.md#aal2reauth), および [4.3.3](sec4_aal.md#aal3reauth) のガイドラインを超えて延長してはならない (**SHALL NOT**).
Session の有効期限が切れる前に, [Table 2](sec7_session.md#table-2) で指定された Authentication Factor を Subscriber に求めることで, Reauthentication タイムリミットを延長すること (**SHALL**).

<!--
When a session has been terminated, due to a time-out or other action, the subscriber **SHALL** be required to establish a new session by authenticating again.
-->

タイムアウトか他のアクションにより Session が終了した場合は, Subscriber に再度 Authentication を行い新たな Session を確立するよう要求すること (**SHALL**).

[Table 2 AAL Reauthentication Requirements](sec7_session.md#table-2){:name="table-2"}
{:latex-ignore="true"}

<!--
|AAL|Requirement|
|----|----|
|1|Presentation of any one factor|
|2|Presentation of a memorized secret or biometric|
|3|Presentation of all factors|
{:latex-table="2" latex-caption="AAL Reauthentication Requirements"}
-->

|AAL|Requirement|
|----|----|
|1| 任意の1ファクターの提示 |
|2| Memorized Secret ないし Biometric の提示 |
|3| 全ファクターの提示 |
{:latex-table="2" latex-caption="AAL Reauthentication Requirements"}

<!--
>Note: At AAL2, a memorized secret or biometric, and not a physical authenticator, is required because the session secret is *something you have*, and an additional authentication factor is required to continue the session.
-->

>Note: AAL2 では, 物理 Authenticator ではなく Memorized Secret や Biometric が求められる. Session Secret は *something you have* であるため, Session の継続には追加の Authentication Factor が求められるのである.

### Reauthentication from a Federation or Assertion

<!--
When using a federation protocol and Identity Provider (IdP) to authenticate at the RP as described in [[SP800-63C]](../_sp800-63c/sec1_purpose.md#purpose){:latex-href="#ref-SP800-63C"}, special considerations apply to session management and reauthentication. The federation protocol communicates an authentication event at the IdP to the RP using an assertion, and the RP then begins an authenticated session based on the successful validation of this assertion. Since the IdP and RP manage sessions separately from each other and the federation protocol does not connect the session management between the IdP and RP, the termination of the subscriber's sessions at an IdP and at an RP are independent of each other. Likewise, the subscriber's sessions at multiple different RPs are established and terminated independently of each other.
-->

[[SP800-63C]](../_sp800-63c/sec1_purpose.md#purpose){:latex-href="#ref-SP800-63C"} で述べたように, RP に Authenticate するために Federation Protocol と Identity Provider (IdP) を使用する場合は, Session Management と Reauthentication に特別な考慮事項が適用される.
Federation Protocol は Assertion を用いて IdP での Authentication イベントを RP に伝達し, RP はこの Assertion の検証の成功をもって Authenticated Session を開始する.
IdP と RP は Session を個別に管理し, Federation Protocol は　IdP と RP の Session Management を接続しないため, IdP と RP での Session の終了は互いに独立して行われる.
同様に, Subscriber が複数の RP で持つ Session は, 互いに独立して確立および終了される.

<!--
Consequently, when an RP session expires and the RP requires reauthentication, it is entirely possible that the session at the IdP has not expired and that a new assertion could be generated from this session at the IdP without explicitly reauthenticating the subscriber. The IdP can communicate the time and details of the authentication event to the RP, but it is up to the RP to determine if reauthentication requirements have been met. Section 5.3 of [[SP800-63C]](../_sp800-63c/sec5_federation.md#federation-session){:latex-href="#ref-SP800-63C"} provides additional details and requirements for session management within a federation context.
-->

したがって, RP Session が期限切れになり RP が Reauthentication を要求する時, IdP の Session が期限切れになっておらず, Subscriber を明示的に Reauthenticate することなく, IdP のこの Session にもとづいて新たな Assertion が生成される可能性は十分にある.
IdP が Authentication イベントの発生時間および詳細を RP に伝えることもできるが, Reauthentication 要件が満たされているかを判断する責任は RP にある.
[[SP800-63C]](../_sp800-63c/sec5_federation.md#federation-session){:latex-href="#ref-SP800-63C"} Section 5.3 には Federation コンテキストにおける Session Management に関するさらなる詳細および要件が記載されている.
